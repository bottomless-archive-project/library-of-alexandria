<style>
  .application-card {
    background: darkseagreen;
  }
</style>

<div class="modal fade" id="queueApplicationModal" tabindex="-1" aria-labelledby="queueApplicationModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="queueApplicationModalLabel">Queue Application</h5>
        <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>
          The <b>Queue Application</b> is a simple glue between the <b>Vault Application</b>, <b>Downloader
          Application</b>, and <b>Generator Application</b>. It exists to make these applications tightly coupled and
          scalable. It works as a <a href="https://en.wikipedia.org/wiki/Message_queue">message queue</a> provider
          between these processes. It has two queues.
        </p>

        <p>
          The <b>loa-document-location</b> contains the URLs that should be visited for document downloading. It is
          connecting the <b>Generator Application</b> and the <b>Downloader Application</b>.
        </p>

        <p>
          The <b>loa-document-archiving</b> contains the metadata for the downloaded documents thats are in the staging
          area. It connects the <b>Downloader Application</b> and the <b>Vault Application</b>.
        </p>

        <p>
          Both of these queues are persistent, so if the Queue Application is stopped, the messages are not going
          to be lost.
        </p>

        <p>
          The queues contain only basic text (like urls) and metadata (like content length, file type, etc). All
          of this data is sent in a binary format, so it is fairly compact. Because of this, the whole application
          doesn't require a lot of storage space. A big deployment might need around 100 GB, while a small-is
          deployment can fit on around 10 GB. The data access pattern consist of a lot of small IO operations.
          Because of this, an SSD is recommended for storing the application's data.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="card mb-2">
  <div class="card-body">
    <span class="bi bi-question-circle" style="float: right; line-height: 0; cursor: pointer;"
          data-bs-toggle="modal" data-bs-target="#queueApplicationModal">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-question-circle"
           viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0
        1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0
        .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056
        0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0
        1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"></path>
      </svg>
    </span>
    <h5 class="card-title">Queue Applications</h5>
    <div class="row">
      <div class="col-12 col-md-4" *ngFor="let queue of applications.queues">
        <div class="card application-card">
          <div class="card-body">
            <p class="m-0">Host: {{queue.host}}</p>
            <p class="m-0">Port: {{queue.port}}</p>
            <p class="m-0">Messages in location queue: {{queue.documentLocationQueueCount}}</p>
            <p class="m-0">Messages in archiving queue: {{queue.documentArchivingQueueCount}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="vaultApplicationModal" tabindex="-1" aria-labelledby="vaultApplicationModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="vaultApplicationModalLabel">Vault Application</h5>
        <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>
          The Vault Application connects to the <b>Queue Application</b>, asks for the metadata of new documents that
          should be archived (these were inserted by the <b>Downloader Application</b> to the queue previously).
        </p>

        <p>
          When a metadata entry is acquired, the application will look up if the document is a duplicate. If it is, then
          it updates the document's entry in the database to contain the new source for the document, then asks the
          <b>Staging Application</b> to remove the document's content from the staging area. If it is not a duplicate,
          then it saves the new document entity to the database, then downloads the document's content from the
          <b>Staging Application</b> into a vault location that is available either on local disk or in an AWS S3
          compatible storage.
        </p>

        <p>
          The <b>Vault Application</b> is scalable so more than one instance can run at the same time. This is necessary
          to support more than one storage machines. Each instance of the application has an unique name. When a
          document is stored, then the vault's name that is holding the document's content is also saved to the
          document's metadata in the database. This way it is easy to track which vault instance has which document.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="card mb-2">
  <div class="card-body">
    <span class="bi bi-question-circle" style="float: right; line-height: 0; cursor: pointer;"
          data-bs-toggle="modal" data-bs-target="#vaultApplicationModal">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-question-circle"
           viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0
        1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0
        .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056
        0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0
        1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"></path>
      </svg>
    </span>
    <h5 class="card-title">Vault Applications</h5>
    <div class="row">
      <div class="col-12 col-md-4" *ngFor="let vault of applications.vaults">
        <div class="card application-card">
          <div class="card-body">
            <p class="m-0">Host: {{vault.host}}</p>
            <p class="m-0">Port: {{vault.port}}</p>
            <p class="m-0">Name: {{vault.name}}</p>
            <p class="m-0">Free space: {{vault.freeSpace | bytes}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card mb-2">
  <div class="card-body">
    <h5 class="card-title">Staging Applications</h5>
    <div class="row">
      <div class="col-4" *ngFor="let staging of applications.stagings">
        <div class="card application-card">
          <div class="card-body">
            <p class="m-0">Host: {{staging.host}}</p>
            <p class="m-0">Port: {{staging.port}}</p>
            <p class="m-0">Free space: {{staging.freeSpace | bytes}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="generatorApplicationModal" tabindex="-1" aria-labelledby="generatorApplicationModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="generatorApplicationModalLabel">Generator Application</h5>
        <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>
          The Generator Application connects to the <b>Queue Application</b> and send URLs to be checked and downloaded
          by the <b>Downloader Application</b>.
        </p>

        <p>
          These URLs can come from a file that is either encrypted (with GZIP) or plain text. The file is read line by
          line. Each line should represent a document location.
        </p>

        <p>
          The URLs are validated by the <b>Generator Application</b>. So if an url doesn't end with one of the supported
          file types (ie.: .pdf, .doc, .docx, etc) then it is not going to be added to the document location queue.
          Also, other illegal or invalid urls will be filtered out too.
        </p>

        <div class="callout m-0">
          <h5>A good source for document locations</h5>

          <p class="mb-0">
            If you do not have a lot of URLs ready at hand, take a look into the
            <a href="https://github.com/bottomless-archive-project/url-collector">url-collector</a> project or into the
            <a href="https://github.com/bottomless-archive-project/document-location-database">
              document-location-database</a>. These projects are also curated by the <b>Bottomless Archive Project</b>
            and are created for the specific purpose to give easy access for Library of Alexandria users to a lot of
            possible document locations.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="card mb-2">
  <div class="card-body">
    <span class="bi bi-question-circle" style="float: right; line-height: 0; cursor: pointer;"
          data-bs-toggle="modal" data-bs-target="#generatorApplicationModal">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-question-circle"
           viewBox="0 0 16 16">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0
        1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0
        .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056
        0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0
        1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"></path>
      </svg>
    </span>
    <h5 class="card-title">Generator Applications</h5>
    <div class="row">
      <div class="col-12 col-md-4" *ngFor="let generator of applications.generators">
        <div class="card application-card">
          <div class="card-body">
            <p class="m-0">Host: {{generator.host}}</p>
            <p class="m-0">Port: {{generator.port}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card mb-2">
  <div class="card-body">
    <h5 class="card-title">Downloader Applications</h5>
    <div class="row">
      <div class="col-12 col-md-4" *ngFor="let downloader of applications.downloaders">
        <div class="card application-card">
          <div class="card-body">
            <p class="m-0">Host: {{downloader.host}}</p>
            <p class="m-0">Port: {{downloader.port}}</p>
            <p class="m-0">Parallelism: {{downloader.parallelism}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card mb-2">
  <div class="card-body">
    <h5 class="card-title">Indexer Applications</h5>
    <div class="row">
      <div class="col-12 col-md-4" *ngFor="let indexer of applications.indexers">
        <div class="card application-card">
          <div class="card-body">
            <p class="m-0">Host: {{indexer.host}}</p>
            <p class="m-0">Port: {{indexer.port}}</p>
            <p class="m-0">Parallelism: {{indexer.parallelism}}</p>
            <p class="m-0">Batch size: {{indexer.batchSize}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card mb-2">
  <div class="card-body">
    <h5 class="card-title">Administrator Applications</h5>
    <div class="row">
      <div class="col-12 col-md-4" *ngFor="let administrator of applications.administrators">
        <div class="card application-card">
          <div class="card-body">
            <p class="m-0">Host: {{administrator.host}}</p>
            <p class="m-0">Port: {{administrator.port}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
